<!DOCTYPE html>
<html lang="en">

<head>
    <title>Apply to NJHS</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <meta name="author" content="Rancho NJHS">
</head>

<body>

  <!-- ======================= Header START (loaded from layout.html)-->
  <header class="navbar-placeholder"> <!-- not named "navbar" so it's unique from the actual navbar-->

      <script src="https://code.jquery.com/jquery-1.10.2.js"></script>

      <div id="nav-placeholder">

      </div>

      <script>
          $(function() {
              $("#nav-placeholder").load("layout.html");
          });
      </script>
  </header>
  <!-- ======================= Header END -->
    <main>
        <div class="container">
            <h1 class="display-2" style="color:#1c1641">Apply to NJHS</h1><hr>
            <div style="text-align:center;width:100%">
                <p class="lead">Are you a prospective seventh grader looking to join in on the fun? Tell us a little more about yourself here!<br><br>Make sure all Google Docs are set to "Anyone can view."</p>
                <br>
                
                <iframe name="formSending" hidden></iframe>
                <form id="application-form" class="gform" data-email="ranchosjnjhs@gmail.com" action="https://script.google.com/macros/s/AKfycbxfvLj1y9OUcrH5VYgflVmQXhEQrZqA4Fk8A0R6iNGwwa-5bNCivev0i6VHDqjpB8HV5w/exec" method="post" style="text-align:left;" target="formSending">
                    <div class="form-group" id="name">
                        <label for="name">Name</label>
                        <input class="form-control" autofocus type="text" name="name" placeholder="Your Name" required>
                    </div>
                    <div class="form-group" id="email">
                        <label for="email">School Email Address</label>
                        <input class="form-control" autofocus type="email" name="email" placeholder="Your Email Address" required>
                    </div>
                    
                    <br>

                    <div id="g_id_onload"
                        data-client_id="20274814841-cj93hcl5d02p7kcl81ja0pqvaukv00pt.apps.googleusercontent.com"
                        data-context="signin"
                        data-ux_mode="popup"
                        data-callback="emailAuth"
                        data-auto_prompt="false">
                    </div>

                    <div class="g_id_signin"
                        data-type="standard"
                        data-shape="rectangular"
                        data-theme="outline"
                        data-text="continue_with"
                        data-size="large"
                        data-logo_alignment="left">
                    </div>

                    <div style="display:none" class="thankyou_message">
                        <br>
                        Thanks for applying! We're excited for you and hope to see you next year!
                    </div>

                    <script>
                        var authenticated = false;
                
                        function emailAuth(response) {
                
                            // parse jwt
                            var base64Url = response.credential.split('.')[1];
                            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                            var jsonPayload = JSON.parse(decodeURIComponent(window.atob(base64).split('').map(function(c) {
                                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                            }).join('')));
                
                            if (jsonPayload.email.endsWith("@iusd.org")) {
                                document.querySelector("#application-form").submit();
                                document.querySelector(".thankyou_message").style.display = "block";
                            } else {
                                alert("Unfortunately, only Rancho students are allowed to apply to NJHS. If you are a Rancho student and got this error wrongly, try signing in with your IUSD account instead.")
                            }
                        }
                    </script>

                    
                </form>
            </div>
        </div>
    </main>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
</body>

</html>
