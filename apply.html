<!DOCTYPE html>
<html lang="en">

<head>
    <title>Apply to NJHS</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <meta name="author" content="Rancho NJHS">
</head>

<body>

  <!-- ======================= Header START (loaded from layout.html)-->
  <header class="navbar-placeholder"> <!-- not named "navbar" so it's unique from the actual navbar-->

      <script src="https://code.jquery.com/jquery-1.10.2.js"></script>

      <div id="nav-placeholder">

      </div>

      <script>
          $(function() {
              $("#nav-placeholder").load("layout.html");
          });
      </script>
  </header>
  <!-- ======================= Header END -->
    <main>
        <div class="container">
            <h1 class="display-2" style="color:#1c1641">Apply to NJHS</h1><hr>
            <div style="text-align:center;width:100%">
                <p class="lead">Are you a prospective seventh grader looking to join in on the fun? Tell us a little more about yourself here!<br><br>NJHS application packet can be found <a href="https://docs.google.com/document/d/1_ZSK0AGjy0nzL1yhdPqdbNRMuZAiquMIgmrSAFU9dX4/copy">here</a>, and printouts can be found <a href="https://docs.google.com/document/d/1FhFcoL0Bq2ZYf1xuM9TsO6Aas1UxANfYgt8CBo-jPoA/edit?usp=sharing">here</a>. To download a Google Doc for upload, click File>Download>PDF.</p>
                <br>
                
                <iframe name="formSending" hidden></iframe>
                <div id="application-form" class="gform" data-email="ranchosjnjhs@gmail.com" action="https://script.google.com/macros/s/AKfycbxfvLj1y9OUcrH5VYgflVmQXhEQrZqA4Fk8A0R6iNGwwa-5bNCivev0i6VHDqjpB8HV5w/exec" method="post" style="text-align:left;" target="formSending">
                    <div class="form-group" id="name">
                        <label for="name">Name</label>
                        <input class="form-control" autofocus type="text" name="name" placeholder="Your Name" required>
                    </div>
                    <div class="form-group" id="email">
                        <label for="email">School Email Address</label>
                        <input class="form-control" autofocus type="email" name="email" placeholder="Your Email Address" required>
                    </div>
                    <div class="form-group" id="packet">
                        <label for="packet">Application Packet (Microsoft Word Document/PDF)</label>
                        <input class="btn btn-primary" autofocus type="file" name="packet" accept=".doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,.pdf" placeholder="Upload File" required>
                    </div>
                    <div class="form-group" id="letter">
                        <label for="packet">Application Letter (Microsoft Word Document/PDF)</label>
                        <input class="btn btn-primary" autofocus type="file" name="letter" accept=".doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,.pdf" placeholder="Upload File" required>
                    </div>
                    <label for="reminder">Sign In To Submit</label>

                    <div class="btn"></div>
                        <div id="g_id_onload"
                            data-client_id="20274814841-cj93hcl5d02p7kcl81ja0pqvaukv00pt.apps.googleusercontent.com"
                            data-context="signin"
                            data-ux_mode="popup"
                            data-callback="emailAuth"
                            data-auto_prompt="false">
                        </div>

                        <div class="g_id_signin"
                            data-type="standard"
                            data-shape="rectangular"
                            data-theme="outline"
                            data-text="continue_with"
                            data-size="large"
                            data-logo_alignment="left">
                        </div>
                    </div>

                    <br>
                    <label for="reminder">Remember- you are also turning in Part IV, Signatures and the Teacher Signature Form in person in addition to your online application.</label>

                    <div style="display:none" class="thankyou_message">
                        <br>
                        Thanks for applying! We're excited for you and hope to see you next year!
                    </div>

                    <script>
                        var authenticated = false;
                        var formCompleted = true;

                        document.querySelector('.g_id_signin').style="display: block; position: relative; height: 44px; width: 238px; border: 0px none; margin: auto;";
                
                        function emailAuth(response) {
                
                            // parse jwt
                            var base64Url = response.credential.split('.')[1];
                            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                            var jsonPayload = JSON.parse(decodeURIComponent(window.atob(base64).split('').map(function(c) {
                                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                            }).join('')));
                
                            if (jsonPayload.email.endsWith("@iusd.org")) {

                                //validate all form fields
                                if (!document.querySelector("input[name='name']").checkValidity()) {
                                    formCompleted = false;
                                    document.querySelector("input[name='name']").style = "border: 2px solid red;"
                                }

                                if (!document.querySelector("input[name='email']").checkValidity()) {
                                    formCompleted = false;
                                    document.querySelector("input[name='email']").style = "border: 2px solid red;"
                                }

                                if (!document.querySelector("input[name='packet']").checkValidity()) {
                                    formCompleted = false;
                                    document.querySelector("input[name='packet']").style = "border: 2px solid red;"
                                }

                                if (!document.querySelector("input[name='letter']").checkValidity()) {
                                    formCompleted = false;
                                    document.querySelector("input[name='letter']").style = "border: 2px solid red;"
                                }

                                if (formCompleted) {
                                    document.querySelector("#application-form").submit();
                                    document.querySelector(".thankyou_message").style.display = "block";
                                }
                                else {
                                    alert("Please complete all fields before submitting!")
                                }
                            } else {
                                alert("Unfortunately, only Rancho students are allowed to apply to NJHS. If you are a Rancho student and got this error wrongly, try signing in with your IUSD account instead.")
                            }
                        }
                    </script>

                    
                </form>
            </div>
        </div>
    </main>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
</body>

</html>
